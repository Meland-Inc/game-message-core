syntax = "proto3";
package gameMessageCore;
option go_package = "./messageGo/proto";

import "message_cmd.proto";
import "player.proto";
import "os.proto";
import "platform.proto";
import "item.proto";
import "item_slot.proto";
import "entity.proto";
import "entityProfile.proto";
import "skill.proto";
import "task.proto";
import "chat.proto";
import "vector.proto";




// 消息交互体.
message Envelope { 
  EnvelopeType  type = 1;
  int32         seq_id = 2;
  int32         error_code = 3;
  string        error_message = 4;

  oneof payload {
    //保留id协议      : 0x00ZZZZ   *********************************************** 
    

    //mainServer协议 : 0x01ZZZZ  主数据服务协议************************************
    ItemGetRequest                    item_get_request                      = 0x010001;
    ItemGetResponse                   item_get_response                     = 0x010002;
    ItemUseRequest                    item_use_request                      = 0x010003;
    ItemUseResponse                   item_use_response                     = 0x010004;
    ItemDropRequest                   item_drop_request                     = 0x010005;
    ItemDropResponse                  item_drop_response                    = 0x010006;
    UpdateAvatarRequest               update_avatar_request                 = 0x010007;
    UpdateAvatarResponse              update_avatar_response                = 0x010008;
    UnloadAvatarRequest               unload_avatar_request                 = 0x010009;
    UnloadAvatarResponse              unload_avatar_response                = 0x010010;
    BroadCastItemAddResponse          broad_cast_item_add_response          = 0x010011;
    BroadCastItemUpdateResponse       broad_cast_item_update_response       = 0x010012;
    BroadCastItemDelResponse          broad_cast_item_del_response          = 0x010013;
    BroadCastUpdateItemSlotResponse   broad_cast_update_item_slot_response  = 0x010014;
    GetItemSlotRequest                get_item_slot_request                 = 0x010015;
    GetItemSlotResponse               get_item_slot_response                = 0x010016;
    UpgradeItemSlotRequest            upgrade_item_slot_request             = 0x010017;
    UpgradeItemSlotResponse           upgrade_item_slot_response            = 0x010018;
    SigninPlayerRequest               signin_player_request                 = 0x010019;
    SigninPlayerResponse              signin_player_response                = 0x010020;
    SignOutPlayerRequest              sign_out_player_request               = 0x010021;
    SignOutPlayerResponse             sign_out_player_response              = 0x010022;
    UpgradePlayerLevelRequest         upgrade_player_level_request          = 0x010023;
    UpgradePlayerLevelResponse        upgrade_player_level_response         = 0x010024;

    //accountSer协议 : 0x02ZZZZ  账号服务 协议 ************************************
    QueryPlayerRequest                query_player_request                  = 0x020001;
    QueryPlayerResponse               query_player_response                 = 0x020002;
    CreatePlayerRequest               create_player_request                 = 0x020003;
    CreatePlayerResponse              create_player_response                = 0x020004;


    //screenSer 协议 : 0x03ZZZZ  战斗服务 协议 ************************************
    EnterMapRequest                   enter_map_request                     = 0x030001;    
    EnterMapResponse                  enter_map_response                    = 0x030002;
    UpdateSelfLocationRequest         update_self_location_request          = 0x030003;
    UpdateSelfLocationResponse        update_self_location_response         = 0x030004;
    UseSkillRequest                   use_skill_request                     = 0x030005;
    UseSkillResponse                  use_skill_response                    = 0x030006;
    PickFallingObjectRequest          pick_falling_object_request           = 0x030007;
    PickFallingObjectResponse         pick_falling_object_response          = 0x030008;
    RespawnPlayerRequest              respawn_player_request                = 0x030009;
    RespawnPlayerResponse             respawn_player_response               = 0x030010;
    BroadCastInitMapElementResponse   broad_cast_init_map_element_response  = 0x030011;
    BroadCastMapEntityUpdateResponse  broad_cast_map_entity_update_response = 0x030012;
    BroadCastEntityDestroyResponse    broad_cast_entity_destroy_response    = 0x030013;
    BroadCastEntityMoveResponse       broad_cast_entity_move_response       = 0x030014;
    BroadCastEntityCombatResponse     broad_cast_entity_combat_response     = 0x030015;
    BroadCastRespawnPlayerResponse    broad_cast_respawn_player_response    = 0x030016;   
    TeleportRequest                   teleport_request                      = 0x030017;
    TeleportResponse                  teleport_response                     = 0x030018;
    BroadCastEntityProfileUpdateResponse    broad_cast_entity_profile_update_response = 0x030019;
    BroadCastMonsterDeathResponse           broad_cast_monster_death_response         = 0x030021;
    BroadCastEntityAvatarUpdateResponse     broad_cast_entity_avatar_update_response  = 0x030022;
                                   

    //taskServer协议 : 0x04ZZZZ  任务服务 协议 ************************************
    SelfTasksRequest                  self_tasks_request                    = 0x040001;
    SelfTasksResponse                 self_tasks_response                   = 0x040002;
    BroadCastUpdateTaskListResponse   broad_cast_update_task_list_response  = 0x040003;
    AcceptTaskRequest                 accept_task_request                   = 0x040004;
    AcceptTaskResponse                accept_task_response                  = 0x040005;
    AbandonmentTaskRequest            abandonment_task_request              = 0x040006;
    AbandonmentTaskResponse           abandonment_task_response             = 0x040007;
    TaskRewardRequest                 task_reward_request                   = 0x040008;
    TaskRewardResponse                task_reward_response                  = 0x040009;
    TaskListRewardRequest             task_list_reward_request              = 0x040010;
    TaskListRewardResponse            task_list_reward_response             = 0x040011;
    UpgradeTaskProgressRequest        upgrade_task_progress_request         = 0x040012;
    UpgradeTaskProgressResponse       upgrade_task_progress_response        = 0x040013;
    BroadCastTaskRewardResponse       broad_cast_task_reward_response       = 0x040014;


    //chatServer协议 : 0x05ZZZZ  聊天服务 协议 ************************************
    SendChatMessageRequest            send_chat_message_request                 = 0x0510001;
    SendChatMessageResponse           send_chat_message_response                = 0x0510002;
    BroadCastChatMessagesResponse     broad_cast_chat_messages_response         = 0x0510003;
    BroadCastRemoveChatMessageResponse broad_cast_remove_chat_message_response  = 0x0510004;
    BroadCastUpdateChatStateResponse  broad_cast_update_chat_state_response     = 0x0510005;


    //getaway   协议 : 0x06ZZZZ  网关服务 协议 ************************************
    PingRequest                       ping_request                          = 0x060001;
    PingResponse                      ping_response                         = 0x060002;
    

    //ServiceMgr协议 : 0x09ZZZZ  服务管理 协议(客户端不能调用) **********************

    //CTRlServer协议 : 0x0aZZZZ  控制服务 协议 ************************************ 

  }
}

//***************************************************************************
//***************************************************************************


//保留id协议      : 0x00ZZZZ   ***********************************************      

//mainServer协议 : 0x01ZZZZ  主数据服务协议************************************
message ItemGetRequest {}
message ItemGetResponse {
  repeated Item   items = 1;
}
message ItemUseRequest { 
  string          item_id = 1;  // 使用的道具 id
}
message ItemUseResponse {
}
message ItemDropRequest {
  string item_id = 1;
  int32  num = 2;
}
message ItemDropResponse {
}
// 穿装备
message UpdateAvatarRequest {
  string          item_id = 1;
  AvatarPosition  position = 2; // 装备的位置
}
message UpdateAvatarResponse {
}
// 卸下装备
message UnloadAvatarRequest {
  string item_id = 1;
}
message UnloadAvatarResponse {
}
message BroadCastItemAddResponse {
  repeated Item   items = 1;
}
message BroadCastItemUpdateResponse {
  repeated Item   items = 1;
}
message BroadCastItemDelResponse {
  repeated Item   items = 1;
}

message BroadCastUpdateItemSlotResponse{
  repeated ItemSlot slots = 1;
}
message GetItemSlotRequest {
}
message GetItemSlotResponse{
  repeated ItemSlot slots = 1;
}
message UpgradeItemSlotRequest{
  AvatarPosition    position = 1;
}
message UpgradeItemSlotResponse{
  repeated ItemSlot slots = 1;
}

message SigninPlayerRequest {
  int64           user_id = 1;
  string          token   = 2;      // token校验信息
  int64           client_time = 3;
  bool            reconnect = 4;
  OSType          os_type = 5;      // 渠道(android/ios)
  PlatformType    platform = 6;     // 平台(taptap...)
  // 客户端期望链接的scene_service_app_id,仅在开发模式有效
  string          scene_service_app_id = 7; 
}
message SigninPlayerResponse {
  Player          player = 1; // 玩家信息
  int64           server_time = 2;
  int64           client_time = 3;
  string          scene_service_app_id = 4;
  int64           last_login_time = 5; //上次登录banner的时间
}
message SignOutPlayerRequest{}
message SignOutPlayerResponse{}

message BroadCastEntityProfileUpdateResponse {
  EntityId entity_id = 1;
  repeated EntityProfileUpdate profiles = 2;
}

message BroadCastMonsterDeathResponse{
  int32                 map_id = 1;
  int64                 killer_id = 2;
  int64                 monster_id = 3;
  int32                 cid = 4; 
  Vector3               pos = 5;
  repeated ItemBaseInfo drop_list = 6;
}

message  UpgradePlayerLevelRequest{}
message  UpgradePlayerLevelResponse{
  int32  cur_level = 1;
  int64  cur_exp   = 2;
}

//accountSer协议 : 0x02ZZZZ  账号服务 协议 ************************************
message QueryPlayerRequest {
  string          token = 1; 
}
message QueryPlayerResponse {
  PlayerBaseData  player = 1; // 玩家信息
}

message CreatePlayerRequest {
  string          token = 1;
  string          nick_name = 2;// 名字
  int32           role_id = 3;  // 配置 ID
  string          gender = 4;   // 玩家性别，男生为 male, 女生为 female
  string          icon = 5;     //角色头像
  PlayerFeature   feature = 6;  // 容貌数据
  OSType          os_type = 7;  // 渠道(android/ios)
  PlatformType    platform = 8; // 平台(taptap...)
}
message CreatePlayerResponse {
  PlayerBaseData  player = 1; // 玩家信息
}


//screenSer 协议 : 0x03ZZZZ  战斗服务 协议 ************************************
message EnterMapRequest {}
message EnterMapResponse {
  // 当前玩家信息
  Player          me = 1;
  // 当前玩家位置
  EntityLocation  location = 2;
  int32           relive_time = 3;
}
message UpdateSelfLocationRequest {
  EntityMovement  movement = 1;
}
message UpdateSelfLocationResponse {
  EntityMovement  movement = 1;
}
message UseSkillRequest {
  // 使用的技能 id
  int32           skill_id = 1;
  // 技能使用方向，相对于玩家当前位置.
  EntityLocation  dir = 2;
  // 技能使用的位置  指定后，会将玩家重置到该位置.
  EntityLocation  from_location = 3;
  // 技能指定使用的目标
  EntityId        target_id = 4;
  // 连击动作
  int32           combo_index = 5;
}
message UseSkillResponse {
}
// 拾取一个掉落物
message PickFallingObjectRequest {
  int64           falling_object_id = 1;
}
message PickFallingObjectResponse {
  // 拾取到的掉落物记录
  FallingObject   falling_objects = 1;
  // 拾取的玩家
  Player          pickup_player = 2;
}
message RespawnPlayerRequest {
  PlayerRespawnPoint respawn_point = 1;
}
message RespawnPlayerResponse {
  int64          user_id = 1;
  int32          cur_hp = 2;
  bool           active = 3;
  EntityLocation location = 4;
}
message BroadCastRespawnPlayerResponse {
  int64          user_id = 1;
  int32          cur_hp = 2;
  bool           active = 3;
  EntityLocation location = 4;
  int64 revive_cd = 5;
}
message BroadCastInitMapElementResponse {
  // 视野内新增的实体列表
  repeated EntityWithLocation entity = 1; //实体
  bool     final = 2; // 是否最后一个包
}
// 实体拾取掉落推送
message BroadCastFallingObjectPickedResponse {
  // 拾取到的掉落物记录
  repeated FallingObject  falling_objects = 1;
  // 拾取的实体
  EntityId                entity_id = 2;
}
message BroadCastMapEntityUpdateResponse{
  // 视野内新增的实体列表
  repeated EntityWithLocation entity_added = 1;
  // 视野内移除的实体列表
  repeated EntityId           entity_removed = 2;
}
message BroadCastEntityMoveResponse{
  repeated EntityMovement     moves = 1;
}
message BroadCastEntityDestroyResponse{
    // 销毁的 实体列表
  repeated EntityId           entities = 1;
}
message BroadCastEntityCombatResponse{
  // 技能释放阶段
  EntityCombatState state = 1;
  // 使用的技能 id
  int32 skill_id = 2;
  // 连击动作
  int32 combo_index = 3;
  // 使用技能的对象 id
  EntityId from_entity = 4;
  // 技能使用方向，相对于释放玩家当前位置.
  EntityLocation dir = 5;
  // 技能释放的位置
  EntityLocation from_location = 6;
  // 接收技能伤害的对象 id 数组
  repeated EntityDamage targets = 7;
}

message TeleportRequest {
  Vector3 to_pos = 9;
}
message TeleportResponse {
}
message BroadCastEntityAvatarUpdateResponse {
  // 变化的entity id
  EntityId              entity_id = 1;
  // 变化后的 avatar 装备列表
  repeated PlayerAvatar avatars = 2;
}



//taskServer协议 : 0x04ZZZZ  任务服务 协议 ************************************

message SelfTasksRequest {}
message SelfTasksResponse {
  // 玩家已经接取的任务列表
  PlayerTask        tasks = 1;
}
// 玩家任务状态更新
message BroadCastUpdateTaskListResponse {
  TaskListType      kind = 1;
  TaskList          task_list_info = 2;
}
// 领取任务
message  AcceptTaskRequest{
  TaskListType      kind = 1;
}
message  AcceptTaskResponse{
  TaskList          task_list_info = 1;
}
// 放弃任务(任务有保护时间)
message  AbandonmentTaskRequest{
  // task list type
  TaskListType    kind = 1;
}
message  AbandonmentTaskResponse{
  TaskList        task_list_info = 1;
}
// 获取任务奖励
message  TaskRewardRequest{
  TaskListType    task_list_kind = 1;
}
message  TaskRewardResponse{
  TaskList        task_list_info = 1;
}
// 获取任务链奖励
message  TaskListRewardRequest{
  TaskListType    kind = 1;
}
message  TaskListRewardResponse{
  TaskList        task_list_info = 1;
}

message  UpgradeTaskProgressRequest{
  TaskListType    task_list_kind = 1;
  // item NFT ids : 提交寻物任务的 附带信息
  repeated TaskOptionItem items = 2;
  // move to pos 附带信息
  TaskOptionMoveTo        pos = 3;
  // quiz 附加信息
  TaskOptionQuiz          quiz = 4;
}
message  UpgradeTaskProgressResponse{
}
message BroadCastTaskRewardResponse{
  bool                    is_task_list_reward = 1;
  TaskListType            task_list_kind = 2;
  int32                   reward_exp = 3;
  repeated ItemBaseInfo   reward_item = 4;
}





//chatServer协议 : 0x05ZZZZ  聊天服务 协议 ************************************

message SendChatMessageRequest {
  ChatChannelType chat_type = 1;
  string          content = 2;
  // 发送到*世界/分线/附近/副本*这些公共频道的时候不需要带`receiver_id`
  // 只有*私聊*需要带`receiver_id`
  int64          receiver_player_id = 3;
}
message SendChatMessageResponse {
  int64          msg_id = 1;
}
// 玩家接收到的聊天信息
message BroadCastChatMessagesResponse {
  repeated ChatMessage    messages = 1;
  bool                    historical_record = 2;
}
message BroadCastRemoveChatMessageResponse{
  repeated int64  msg_ids = 1;
}
message BroadCastUpdateChatStateResponse{
  ChatState       chat_state = 1;
}



//getaway   协议 : 0x06ZZZZ  网关服务 协议 ************************************
message PingRequest {}
message PingResponse {}

//ServiceMgr协议 : 0x09ZZZZ  服务管理 协议(客户端不能调用) **********************






//CTRlServer协议 : 0x0aZZZZ  控制服务 协议 ************************************ 

