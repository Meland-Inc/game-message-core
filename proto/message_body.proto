syntax = "proto3";
package gameMessageCore;
option go_package = "./messageGo/proto";

import "message_cmd.proto";
import "player.proto";
import "os.proto";
import "platform.proto";
import "item.proto";
import "item_slot.proto";
import "entity.proto";
import "skill.proto";


// 消息交互体.
message Envelope { 
  EnvelopeType  type = 1;
  int32         seq_id = 2;
  int32         error_code = 3;
  string        error_message = 4;

  oneof payload {
    //保留id协议      : 0x00ZZZZ   *********************************************** 
    

    //mainServer协议 : 0x01ZZZZ  主数据服务协议************************************
    ItemGetRequest                    item_get_request                      = 0x010001;
    ItemGetResponse                   item_get_response                     = 0x010002;
    ItemUseRequest                    item_use_request                      = 0x010003;
    ItemUseResponse                   item_use_response                     = 0x010004;
    ItemDropRequest                   item_drop_request                     = 0x010005;
    ItemDropResponse                  item_drop_response                    = 0x010006;
    UpdateAvatarRequest               update_avatar_request                 = 0x010007;
    UpdateAvatarResponse              update_avatar_response                = 0x010008;
    UnloadAvatarRequest               unload_avatar_request                 = 0x010009;
    UnloadAvatarResponse              unload_avatar_response                = 0x010010;
    BroadCastItemAddResponse          broad_cast_item_add_response          = 0x010011;
    BroadCastItemUpdateResponse       broad_cast_item_update_response       = 0x010012;
    BroadCastItemDelResponse          broad_cast_item_del_response          = 0x010013;
    BroadCastUpdateItemSlotResponse   broad_cast_update_item_slot_response  = 0x010014;
    GetItemSlotRequest                get_item_slot_request                 = 0x010015;
    GetItemSlotResponse               get_item_slot_response                = 0x010016;
    UpgradeItemSlotRequest            upgrade_item_slot_request             = 0x010017;
    UpgradeItemSlotResponse           upgrade_item_slot_response            = 0x010018;
    SigninPlayerRequest               signin_player_request                 = 0x010019;
    SigninPlayerResponse              signin_player_response                = 0x010020;
    SignOutPlayerRequest              sign_out_player_request               = 0x010021;
    SignOutPlayerResponse             sign_out_player_response              = 0x010022;


    //accountSer协议 : 0x02ZZZZ  账号服务 协议 ************************************
    QueryPlayerRequest                query_player_request                  = 0x020001;
    QueryPlayerResponse               query_player_response                 = 0x020002;
    CreatePlayerRequest               create_player_request                 = 0x020003;
    CreatePlayerResponse              create_player_response                = 0x020004;


    //screenSer 协议 : 0x03ZZZZ  战斗服务 协议 ************************************
    EnterMapRequest                   enter_map_request                     = 0x030001;    
    EnterMapResponse                  enter_map_response                    = 0x030002;
    UpdateSelfLocationRequest         update_self_location_request          = 0x030003;
    UpdateSelfLocationResponse        update_self_location_response         = 0x030004;
    UseSkillRequest                   use_skill_request                     = 0x030005;
    UseSkillResponse                  use_skill_response                    = 0x030006;
    PickFallingObjectRequest          pick_falling_object_request           = 0x030007;
    PickFallingObjectResponse         pick_falling_object_response          = 0x030008;
    RespawnPlayerRequest              respawn_player_request                = 0x030009;
    RespawnPlayerResponse             respawn_player_response               = 0x030010;
    BroadCastInitMapElementResponse   broad_cast_init_map_element_response  = 0x030011;
    BroadCastMapEntityUpdateResponse  broad_cast_map_entity_update_response = 0x030012;
    BroadCastEntityDestroyResponse    broad_cast_entity_destroy_response    = 0x030013;
    BroadCastEntityMoveResponse       broad_cast_entity_move_response       = 0x030014;
    BroadCastEntityCombatResponse     broad_cast_entity_combat_response     = 0x030015;
    BroadCastRespawnPlayerResponse    broad_cast_respawn_player_response    = 0x030016;                         
                                   

    //taskServer协议 : 0x04ZZZZ  任务服务 协议 ************************************

    //chatServer协议 : 0x05ZZZZ  聊天服务 协议 ************************************

    //getaway   协议 : 0x06ZZZZ  网关服务 协议 ************************************
    PingRequest                       ping_request                          = 0x060001;
    PingResponse                      ping_response                         = 0x060002;
    

    //ServiceMgr协议 : 0x09ZZZZ  服务管理 协议(客户端不能调用) **********************

    //CTRlServer协议 : 0x0aZZZZ  控制服务 协议 ************************************ 

  }
}

//***************************************************************************
//***************************************************************************


//保留id协议      : 0x00ZZZZ   ***********************************************      

//mainServer协议 : 0x01ZZZZ  主数据服务协议************************************
message ItemGetRequest {}
message ItemGetResponse {
  repeated Item   items = 1;
}
message ItemUseRequest { 
  string          item_id = 1;  // 使用的道具 id
}
message ItemUseResponse {
}
message ItemDropRequest {
  string item_id = 1;
  int32  num = 2;
}
message ItemDropResponse {
}
// 穿装备
message UpdateAvatarRequest {
  string          item_id = 1;
  AvatarPosition  position = 2; // 装备的位置
}
message UpdateAvatarResponse {
}
// 卸下装备
message UnloadAvatarRequest {
  string item_id = 1;
}
message UnloadAvatarResponse {
}
message BroadCastItemAddResponse {
  repeated Item   items = 1;
}
message BroadCastItemUpdateResponse {
  repeated Item   items = 1;
}
message BroadCastItemDelResponse {
  repeated Item   items = 1;
}

message BroadCastUpdateItemSlotResponse{
  repeated ItemSlot slots = 1;
}
message GetItemSlotRequest {
}
message GetItemSlotResponse{
  repeated ItemSlot slots = 1;
}
message UpgradeItemSlotRequest{
  AvatarPosition    position = 1;
}
message UpgradeItemSlotResponse{
  repeated ItemSlot slots = 1;
}

message SigninPlayerRequest {
  int64           user_id = 1;
  string          token   = 2;      // token校验信息
  int64           client_time = 3;
  bool            reconnect = 4;
  OSType          os_type = 5;      // 渠道(android/ios)
  PlatformType    platform = 6;     // 平台(taptap...)
}
message SigninPlayerResponse {
  Player          player = 1; // 玩家信息
  int64           server_time = 2;
  int64           client_time = 3;
  int32           scene_server_id = 4;
  int64           last_login_time = 5; //上次登录banner的时间
}
message SignOutPlayerRequest{}
message SignOutPlayerResponse{}




//accountSer协议 : 0x02ZZZZ  账号服务 协议 ************************************
message QueryPlayerRequest {
  string          token = 1; 
}
message QueryPlayerResponse {
  PlayerBaseData  player = 1; // 玩家信息
}

message CreatePlayerRequest {
  int64           user_id = 1;
  string          nick_name = 2;// 名字
  int32           role_id = 3;  // 配置 ID
  string          gender = 4;   // 玩家性别，男生为 male, 女生为 female
  string          icon = 5;     //角色头像
  PlayerFeature   feature = 6;  // 容貌数据
  OSType          os_type = 7;  // 渠道(android/ios)
  PlatformType    platform = 8; // 平台(taptap...)
}
message CreatePlayerResponse {
  PlayerBaseData  player = 1; // 玩家信息
}


//screenSer 协议 : 0x03ZZZZ  战斗服务 协议 ************************************
message EnterMapRequest {}
message EnterMapResponse {
  // 当前玩家信息
  Player          me = 1;
  // 当前玩家位置
  EntityLocation  location = 2;
  int32           relive_time = 3;
}
message UpdateSelfLocationRequest {
  EntityMovement  movement = 1;
}
message UpdateSelfLocationResponse {
  EntityMovement  movement = 1;
}
message UseSkillRequest {
  // 使用的技能 id
  int32           skill_id = 1;
  // 技能使用方向，相对于玩家当前位置.
  EntityLocation  dir = 2;
  // 技能使用的位置  指定后，会将玩家重置到该位置.
  EntityLocation  from_location = 3;
  // 技能指定使用的目标
  EntityId        target_id = 4;
  // 连击动作
  int32           combo_index = 5;
}
message UseSkillResponse {
}
// 拾取一个掉落物
message PickFallingObjectRequest {
  int64           falling_object_id = 1;
}
message PickFallingObjectResponse {
  // 拾取到的掉落物记录
  FallingObject   falling_objects = 1;
  // 拾取的玩家
  Player          pickup_player = 2;
}
message RespawnPlayerRequest {
  PlayerRespawnPoint respawn_point = 1;
}
message RespawnPlayerResponse {
  int64          user_id = 1;
  int32          cur_hp = 2;
  bool           active = 3;
  EntityLocation location = 4;
}
message BroadCastRespawnPlayerResponse {
  int64          user_id = 1;
  int32          cur_hp = 2;
  bool           active = 3;
  EntityLocation location = 4;
}
message BroadCastInitMapElementResponse {
  // 视野内新增的实体列表
  repeated EntityWithLocation entity = 1; //实体
  bool     final = 2; // 是否最后一个包
}
// 实体拾取掉落推送
message BroadCastFallingObjectPickedResponse {
  // 拾取到的掉落物记录
  repeated FallingObject  falling_objects = 1;
  // 拾取的实体
  EntityId                entity_id = 2;
}
message BroadCastMapEntityUpdateResponse{
  // 视野内新增的实体列表
  repeated EntityWithLocation entity_added = 1;
  // 视野内移除的实体列表
  repeated EntityId           entity_removed = 2;
}
message BroadCastEntityMoveResponse{
  repeated EntityMovement     moves = 1;
}
message BroadCastEntityDestroyResponse{
    // 销毁的 实体列表
  repeated EntityId           entities = 1;
}
message BroadCastEntityCombatResponse{
  // 技能释放阶段
  EntityCombatState state = 1;
  // 使用的技能 id
  int32 skill_id = 2;
  // 连击动作
  int32 combo_index = 3;
  // 使用技能的对象 id
  EntityId from_entity = 4;
  // 技能使用方向，相对于释放玩家当前位置.
  EntityLocation dir = 5;
  // 技能释放的位置
  EntityLocation from_location = 6;
  // 接收技能伤害的对象 id 数组
  repeated EntityDamage targets = 7;
}



//taskServer协议 : 0x04ZZZZ  任务服务 协议 ************************************

//chatServer协议 : 0x05ZZZZ  聊天服务 协议 ************************************

//getaway   协议 : 0x06ZZZZ  网关服务 协议 ************************************
message PingRequest {}
message PingResponse {}

//ServiceMgr协议 : 0x09ZZZZ  服务管理 协议(客户端不能调用) **********************






//CTRlServer协议 : 0x0aZZZZ  控制服务 协议 ************************************ 

